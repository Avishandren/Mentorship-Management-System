<form id="chat-form">
    <input type="hidden" id="receiver_id" value="{{ receiver_id }}">
    <input type="hidden" id="receiver_role" value="{{ receiver_role }}">
    <textarea id="message" placeholder="Type your message..."></textarea>
    <input type="file" id="file">
    <button type="submit">Send</button>
</form>

<div id="chat-container"></div>

<script>
document.getElementById('chat-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    
    const receiver_id = document.getElementById('receiver_id').value;
    const receiver_role = document.getElementById('receiver_role').value;
    const message = document.getElementById('message').value;
    const file = document.getElementById('file').files[0];

    const formData = new FormData();
    formData.append('receiver_id', receiver_id);
    formData.append('receiver_role', receiver_role);
    formData.append('content', message);
    if (file) formData.append('file', file);

    await fetch('/send_message', {
        method: 'POST',
        body: formData
    });

    loadMessages();
});

async function loadMessages() {
    const receiver_id = document.getElementById('receiver_id').value;
    const receiver_role = document.getElementById('receiver_role').value;

    const response = await fetch(`/get_messages/${receiver_id}/${receiver_role}`);
    const messages = await response.json();

    document.getElementById('chat-container').innerHTML = messages.map(msg => 
        `<p>${msg.content} ${msg.file_url ? `<a href="${msg.file_url}">[File]</a>` : ''}</p>`
    ).join('');
}

setInterval(loadMessages, 5000);
</script>
